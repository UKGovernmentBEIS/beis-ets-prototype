{% extends "layouts/admin/base.html" %}

{% set pageID = "transactions" %}

{% block pageTitle %}Transactions {{'- ' + serviceName}}{% endblock %}

{% block content %}


<div class="jui-width-container">
{% from "breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% if query.returnAccount %}
{{ govukBreadcrumbs({
  items: [
    {
      text: "â–² Return to account " + query.returnAccount,
      href: "/account/" + query.returnAccount
    }
  ]
}) }}
{% endif %}
  <main class="govuk-main-wrapper" role="main">

  <h1 class="govuk-heading-l">Transaction search results
  </h1>
  <p>
  <a href="search{% if query.returnAccount %}?returnAccount={{ query.returnAccount }}&persist=No{% endif %}">Refine search query</a>
  </p>

<table class="govuk-table" data-type="transactions">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row govuk-!-font-size-16">
            <th class="govuk-table__header govuk-!-width-10" scope="col">Reference</th>
            <th class="govuk-table__header govuk-!-width-10" scope="col">Started</th>
            <th class="govuk-table__header govuk-!-width-10" scope="col">Last updated</th>
            <th class="govuk-table__header govuk-!-width-10" scope="col">Type</th>
            <th class="govuk-table__header govuk-table__header--numeric govuk-!-width-10" scope="col">Units</th>
            <th class="govuk-table__header govuk-!-width-10" scope="col">Unit Type</th>
            <th class="govuk-table__header govuk-!-width-15" scope="col">Transferring Acct</th>
            <th class="govuk-table__header govuk-!-width-15" scope="col">Acquiring Acct</th>
            <th class="govuk-table__header govuk-!-width-10 govuk-table__header--numeric" scope="col">Status</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
        {% if data.etsSurrenderAllowance.totalAmountSurrendered %}
          <tr class="govuk-table__row govuk-!-font-size-16">
              <th class="govuk-table__cell" scope="row"><a href="#">EU596032</th>
              <td class="govuk-table__cell ">
                {{ currentDate | date("DD MMMM YYYY") }}<br/>
                {{ currentDate | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">
                {{ currentDate | date("DD MMMM YYYY") }}<br/>
                {{ currentDate | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">10-02 Surrender Allowances</td>
              <td class="govuk-table__cell govuk-table__cell--numeric ">
              {% if data.etsSurrenderAllowance.amountToSurrender == 'other' %}
                <strong>140</strong> units oversurrendered
              {% else %}
                {{ data.etsSurrenderAllowance.amountToSurrender }}
              {% endif %}
              </td>
              <td class="govuk-table__cell ">Allowances</td>
              <td class="govuk-table__cell ">{{installationID}}</td>
              <td class="govuk-table__cell "><span style="color: #8A8A8A; letter-spacing: .5px;">SURRENDER</span></td>
              <td class="govuk-table__cell ">
                <span class="jui-status  jui-status--new  govuk-!-margin-left-1" >Awaiting Approval</span>
              </td>
          </tr>
          {% endif %}
          {% if data.etsTransferAllowance %}
          <tr class="govuk-table__row govuk-!-font-size-16">
              <th class="govuk-table__cell" scope="row">EU580697</th>
              <td class="govuk-table__cell ">
                {{ currentDate | date("DD MMMM YYYY") }}<br/>
                {{ currentDate | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">
                {{ currentDate | date("DD MMMM YYYY") }}<br/>
                {{ currentDate | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">10-05 Transfer Allowances</td>
              <td class="govuk-table__cell govuk-table__cell--numeric ">
            {% for unit, value in data.etsTransferAllowance.holdings %}
                {% set unitDisplayName = 'Allowance' if unit == 'generalAllowance' else unit %}
                {% if unit == data.etsTransferAllowance.unitType %}
                {{ value.moved }}
                {% endif %}
            {% endfor %}
              </td>
              <td class="govuk-table__cell ">
            {% for unit, value in data.etsTransferAllowance.holdings %}
                {% set unitDisplayName = 'Allowance' if unit == 'generalAllowance' else unit %}
                {% if unit == data.etsTransferAllowance.unitType %}
                {{ unitDisplayName }}
                {% endif %}
            {% endfor %}
              </td>
              <td class="govuk-table__cell ">{{installationID}}</td>
              <td class="govuk-table__cell ">
              {% if data.etsTransferAllowance.recipientType == 'existing' %}
                {{ data.etsTransferAllowance.recipient}}
              {% elif data.etsTransferAllowance.recipientType == 'new' %}
                {{ data.etsTransferAllowance.recepientId }}
              {% endif %}
            </td>
              <td class="govuk-table__cell ">
                  {% if data.etsTransferAllowance.approved == 'Yes' %}
                  <span class="jui-status  jui-status--new  govuk-!-margin-left-1">Delayed until {{ currentDate | date("DD MMMM YYYY") }}</span>
                  {% else %}
                <span class="jui-status  jui-status--new  govuk-!-margin-left-1" >Awaiting Approval</span>
                  {% endif %}
              </td>
          </tr>
          {% endif %}
            {% for tx in data.transactions | sort(false, false, 'started') %}
          <tr class="govuk-table__row govuk-!-font-size-16">
              <th class="govuk-table__cell" scope="row">{{ tx.transactionId }}</th>
              <td class="govuk-table__cell ">
                {{ tx.started | date("DD MMMM YYYY") }}<br/>
                {{ tx.started | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">
                {{ tx.lastUpdated | date("DD MMMM YYYY") }}<br/>
                {{ tx.lastUpdated | date("h:mm:ss a") }}
              </td>
              <td class="govuk-table__cell ">{{ tx.type }}</td>
              <td class="govuk-table__cell govuk-table__cell--numeric ">{{ tx.units }}</td>
              <td class="govuk-table__cell ">{{ tx.unitType }}</td>
              <td class="govuk-table__cell "><a href="#">{% if tx.transferringAccount == "this" %}EU-100-{{ [73432,82345,73104,77732] | random }}-0-76{% else %}{{ tx.transferringAccount }}{% endif %}</a></td>
              <td class="govuk-table__cell ">
                  {% if tx.type == "Surrender" %}
                    <span style="color: #8A8A8A; letter-spacing: .5px;">SURRENDER</span>
                  {% else %}
                    <a href="#">{% if tx.acquiringAccount == "this" %}EU-100-{{ [73432,82345,73104,77732] | random }}-0-76{% else %}{{ tx.acquiringAccount }}{% endif %}</a>
                  {% endif %}
              </td>
              <td class="govuk-table__cell govuk-table__cell--numeric">
                  {% if tx.status != "4-COMPLETED" %}
                    <span class="jui-status  jui-status--new  govuk-!-margin-left-1" >{{ tx.status }}</span>
                  {% else %}
                    Completed
                  {% endif %}
              </td>
          </tr>
            {% endfor %}

        </tbody>
      </table>

  </main>

</div>

{% endblock %}
{% block page_scripts %}
{% endblock %}
